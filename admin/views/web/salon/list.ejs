<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pink Gossip - Beauty Salon Discovery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FBE3E6',
                        secondary: '#fce7f3',
                        'pink-primary': '#FBE3E6',
                        'pink-secondary': '#fce7f3',
                        'pink-accent': '#EC1F95',
                        'black-secondary': '#22222C',
                        'color-secondary': '#717171',
                        'color-gray-2': '#2C2C2C',
                        'underline-color': '#EBEBEB',
                        'input-border': '#D0D0D0'
                    },
                    fontFamily: {
                        'sans': ['Roboto', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <link
        href="https://fonts.googleapis.com/css2?family=Italiana&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-pink: #EC1F95;
        }

        .active {
            border-bottom: 2px solid var(--primary-pink);

        }

        .active path {
            stroke: var(--primary-pink);
        }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>

<body class="bg-gradient-to-br from-pink-50 to-white font-sans">
    <!-- Top Navigation -->
    <%- include('../../include/_webheader', { session: session }) %>
    <!-- Main Container -->
    <div class="max-w-7xl mx-auto min-h-screen">
        <!-- Main Content -->
        <div class="flex gap-8 p-6">
            <!-- Sidebar -->
            

            <!-- Salon's List -->
            <main class="flex-1 mx-auto space-y-6">
                <!-- Heading -->
                <div>
                    <h2 class="text-3xl font-bold text-gray-900">Find Beauty Salons</h2>
                    <p class="text-gray-600 mt-1">Discover the best beauty salons near you</p>
                </div>
                <!-- Toggle View -->
                <div class="flex items-center bg-white p-1">
                    <button id="listViewBtn"
                        class="flex items-center space-x-2 px-4 py-2 active font-medium transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z" />
                        </svg>


                        <span>Grid View</span>
                    </button>
                    <button id="mapViewBtn"
                        class="flex items-center space-x-2 px-4 py-2 text-gray-600 hover:text-gray-900 font-medium transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="21.2" height="26" viewBox="0 0 21.2 26"
                            class="map-icon">
                            <g id="map-icon" transform="translate(-3.5 -2)">
                                <path id="Path_1" data-name="Path 1"
                                    d="M16.241,11.121A3.621,3.621,0,1,1,12.621,7.5a3.621,3.621,0,0,1,3.621,3.621Z"
                                    transform="translate(1.009 1.453)" fill="rgba(213,213,213,0)" stroke="#717171"
                                    stroke-linecap="round" stroke-linejoin="round" stroke-width="2" />
                                <path id="Path_2" data-name="Path 2"
                                    d="M23.7,12.6c0,9.142-9.6,14.4-9.6,14.4S4.5,21.742,4.5,12.6a9.6,9.6,0,0,1,19.2,0Z"
                                    transform="translate(0 0)" fill="rgba(213,213,213,0)" stroke="#717171"
                                    stroke-linecap="round" stroke-linejoin="round" stroke-width="2" />
                            </g>
                        </svg>

                        <span>Map View</span>
                    </button>
                </div>

                <!-- list View -->
                <div id="listView">
  <div id="salonContainer" class="grid grid-cols-1 sm:grid-cols-2 gap-6"></div>

  <!-- Pagination -->
  <div id="pagination" class="flex justify-center items-center space-x-2 mt-8"></div>
</div>

                <!-- Map View -->
                <div id="mapView" class="hidden pb-6">
                    <div class="bg-white rounded-2xl shadow-lg overflow-hidden" style="height: 600px;">
                        <div id="map" style="height: 100%; width: 100%;"></div>
                    </div>
                </div>

            </main>
        </div>
    </div>
</body>
<script>
  // ✅ Convert your EJS salon data into a JavaScript array
  const salons = [
    <% if (appUserData && appUserData.length > 0) { %>
      <% appUserData.forEach(function(user, index) { %>
        {
          salon_name: "<%= user.salon_name || '' %>",
          first_name: "<%= user.first_name || '' %>",
          last_name: "<%= user.last_name || '' %>",
          profile_image: "<%= user.profile_image ? '/api/' + user.profile_image : '/img/logo3x.png' %>",
          avg_rating: <%= user.avg_rating || 0 %>,
          total_reviews: <%= user.total_reviews || 0 %>,
          email: "<%= user.email || '' %>",
          address: "<%= user.address || '' %>",
          contact_no: "<%= user.contact_no || '' %>",
          site_name: "<%= user.site_name || '' %>"
        }<%= index !== appUserData.length - 1 ? ',' : '' %>
      <% }) %>
    <% } %>
  ];

  const salonContainer = document.getElementById('salonContainer');
  const pagination = document.getElementById('pagination');

  let currentPage = 1;
  const perPage = 6;
  const totalPages = Math.ceil(salons.length / perPage);

  function renderSalons(page) {
    salonContainer.innerHTML = '';

    const start = (page - 1) * perPage;
    const end = start + perPage;
    const currentSalons = salons.slice(start, end);

    currentSalons.forEach(user => {
      const rating = user.avg_rating || 0;
      const fullStars = Math.floor(rating);
      const halfStar = rating - fullStars >= 0.1 ? 1 : 0;
      const emptyStars = 5 - fullStars - halfStar;

      let starsHTML = '';
      for (let i = 0; i < fullStars; i++) starsHTML += `<img src="/img/full_star.svg" class="w-3 h-3" />`;
      if (halfStar) starsHTML += `<img src="/img/half_star.svg" class="w-3 h-3" />`;

      const card = `
        <div class="bg-white rounded-2xl shadow-md overflow-hidden flex">
          <div class="w-full flex flex-col space-x-4">
            <div class="w-full h-[400px] overflow-hidden">
              <img src="${user.profile_image}" class="w-full h-full object-cover" />
            </div>
            <div class="flex w-full">
              <div class="w-full px-4 py-2">
                <h3 class="font-semibold text-gray-900 text-xl">
                  ${user.salon_name ? user.salon_name  : ''}
                </h3>
                <div class="flex items-center space-x-1 mt-1">
                  ${
                    rating > 0
                      ? `<span class="text-sm text-gray-400">${rating.toFixed(1)}</span>
                         <div class="flex space-x-1 items-center">${starsHTML}</div>
                         <span class="text-sm text-gray-400">(${user.total_reviews})</span>`
                      : `<span class="text-sm text-gray-400">No Review</span>`
                  }
                </div>

                <div class="grid grid-cols-1 gap-4 py-4">
                  <div>
                     <div class="flex gap-4">
                      <img src="/img/phone-icon.svg" class="size-5" />
                      <span class="text-color-secondary">${user.contact_no}</span>
                    </div>
                    <div class="flex gap-4">
                      <img src="/img/website-icon.svg" class="size-5" />
                      <span class="text-color-secondary truncate">${user.site_name}</span>
                    </div>
                    <div class="flex gap-4">
                      <img src="/img/map-icon-2.svg" class="size-5" />
                      <span class="text-color-secondary truncate">${user.address}</span>
                    </div>
                  </div>
                  
                </div>
              </div>
            </div>
          </div>
        </div>`;
      salonContainer.insertAdjacentHTML('beforeend', card);
    });

    renderPagination();
  }

  function renderPagination() {
    pagination.innerHTML = '';

    if (totalPages <= 1) return;

    // Prev button
    const prev = document.createElement('button');
    prev.innerHTML = '‹';
    prev.className = `px-3 py-1 rounded-lg border ${currentPage === 1 ? 'text-gray-300 cursor-not-allowed' : 'text-gray-700 hover:bg-gray-100'}`;
    prev.disabled = currentPage === 1;
    prev.addEventListener('click', () => changePage(currentPage - 1));
    pagination.appendChild(prev);

    // Number buttons
    for (let i = 1; i <= totalPages; i++) {
      const btn = document.createElement('button');
      btn.textContent = i;
      btn.className = `px-3 py-1 rounded-lg border ${
        currentPage === i ? 'bg-pink-500 text-white' : 'text-gray-700 hover:bg-gray-100'
      }`;
      btn.addEventListener('click', () => changePage(i));
      pagination.appendChild(btn);
    }

    // Next button
    const next = document.createElement('button');
    next.innerHTML = '›';
    next.className = `px-3 py-1 rounded-lg border ${currentPage === totalPages ? 'text-gray-300 cursor-not-allowed' : 'text-gray-700 hover:bg-gray-100'}`;
    next.disabled = currentPage === totalPages;
    next.addEventListener('click', () => changePage(currentPage + 1));
    pagination.appendChild(next);
  }

  function changePage(page) {
    if (page < 1 || page > totalPages) return;
    currentPage = page;
    renderSalons(page);
  }

  // Initial load
  renderSalons(currentPage);
</script>
<script>
    const listViewBtn = document.getElementById('listViewBtn');
    const mapViewBtn = document.getElementById('mapViewBtn');
    const listView = document.getElementById('listView');
    const mapView = document.getElementById('mapView');
    let map = null;
    listViewBtn.addEventListener('click', () => {
        // Update button styles
        listViewBtn.classList.add('active');
        mapViewBtn.classList.remove('active');

        // Show/hide views
        listView.classList.remove('hidden');
        mapView.classList.add('hidden');
    });

    mapViewBtn.addEventListener('click', () => {
        // Update button styles
        mapViewBtn.classList.add('active');
        listViewBtn.classList.remove('active');

        // Show/hide views
        mapView.classList.remove('hidden');
        listView.classList.add('hidden');

        // Initialize map if not already done
        if (!map) {
            initializeMap();
        }

    });


    
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCRNjykxoRKwqenOpoqBdoYz1CTvPYI5So"></script>

<script>
function initializeMap() {
    const map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 45.508888, lng: 	-73.561668 },
        zoom: 12,
        mapId: "YOUR_MAP_ID" // optional, remove if not using custom style
    });

    const salons = [
        <% if (appUserData && appUserData.length > 0) { %>
            <% appUserData.forEach(function(user, index) { %>
                {
                    name: "<%= user.salon_name %> <% if (user.salon_name) { %>:  <% } %> <%= user.first_name %> <%= user.last_name %>",
                    lat: <%= user.latitude || 0 %>,
                    lng: <%= user.longitude || 0 %>,
                    rating: <%= user.avg_rating || 0 %>,
                    reviews: <%= user.total_reviews || 0 %>
                }<%= index !== appUserData.length - 1 ? ',' : '' %>
            <% }) %>
        <% } %>
    ];

    const custoMarker = {
        url: '/img/marker.svg',
        scaledSize: new google.maps.Size(48, 75)
    };

    function getStarsHTML(rating) {
        const fullStars = Math.floor(rating);
        const halfStar = rating - fullStars >= 0.1 ? 1 : 0;
        const emptyStars = 5 - fullStars - halfStar;
        let starsHTML = "";
        for (let i = 0; i < fullStars; i++) starsHTML += `<img src="/img/full_star.svg" class="w-3 h-3 inline-block" />`;
        if (halfStar) starsHTML += `<img src="/img/half_star.svg" class="w-3 h-3 inline-block" />`;
        return starsHTML;
    }

    const bounds = new google.maps.LatLngBounds();

    salons.forEach(salon => {
        if (!salon.lat || !salon.lng) return;

        const marker = new google.maps.Marker({
            position: { lat: salon.lat, lng: salon.lng },
            map: map,
            icon: custoMarker
        });

        const starsHTML = getStarsHTML(salon.rating);
        const popupContent = `
            <div class="p-2" style="max-width: 200px;">
                <h3 class="font-semibold text-gray-900 mb-1">${salon.name}</h3>
                <div class="flex items-center space-x-1 mb-2">
                    <span class="text-sm font-medium">${salon.rating.toFixed(1)}</span>
                    <div class="flex items-center space-x-1">${starsHTML}</div>
                    <span class="text-sm text-gray-400">(${salon.reviews})</span>
                </div>
            </div>
        `;

        const infoWindow = new google.maps.InfoWindow({ content: popupContent });
        marker.addListener("click", () => infoWindow.open(map, marker));

        bounds.extend(marker.getPosition());
    });

    if (salons.length > 0) map.fitBounds(bounds, { padding: 40 });
}
</script>


</html>